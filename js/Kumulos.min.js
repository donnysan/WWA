// PhoneGap Kumulos Library v0.0.1 
// Library functions used: 
// * code.google.com/p/crypto-js 
// * http://stackoverflow.com/a/1714899/543200 
// * http://stackoverflow.com/a/105074 
(function(){function n(){var e=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}var e=function(t,n){var r=[];for(var i in t){var s=n?n+"["+i+"]":i,o=t[i];r.push(typeof o=="object"?e(o,s):encodeURIComponent(s)+"="+encodeURIComponent(o))}return r.join("&")},t=t||function(e,t){var n={},r=n.lib={},i=r.Base=function(){function e(){}return{extend:function(t){e.prototype=this;var n=new e;return t&&n.mixIn(t),n.$super=this,n},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.$super.extend(this)}}}(),s=r.WordArray=i.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,e=e.sigBytes;this.clamp();if(r%4)for(var i=0;i<e;i++)t[r+i>>>2]|=(n[i>>>2]>>>24-8*(i%4)&255)<<24-8*((r+i)%4);else if(65535<n.length)for(i=0;i<e;i+=4)t[r+i>>>2]=n[i>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-8*(n%4),t.length=e.ceil(n/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],r=0;r<t;r+=4)n.push(4294967296*e.random()|0);return s.create(n,t)}}),o=n.enc={},u=o.Hex={stringify:function(e){for(var t=e.words,e=e.sigBytes,n=[],r=0;r<e;r++){var i=t[r>>>2]>>>24-8*(r%4)&255;n.push((i>>>4).toString(16)),n.push((i&15).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-4*(r%8);return s.create(n,t/2)}},a=o.Latin1={stringify:function(e){for(var t=e.words,e=e.sigBytes,n=[],r=0;r<e;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-8*(r%4)&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(e.charCodeAt(r)&255)<<24-8*(r%4);return s.create(n,t)}},f=o.Utf8={stringify:function(e){try{return decodeURIComponent(escape(a.stringify(e)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(e){return a.parse(unescape(encodeURIComponent(e)))}},l=r.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=s.create(),this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=f.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,o=this.blockSize,u=i/(4*o),u=t?e.ceil(u):e.max((u|0)-this._minBufferSize,0),t=u*o,i=e.min(4*t,i);if(t){for(var a=0;a<t;a+=o)this._doProcessBlock(r,a);a=r.splice(0,t),n.sigBytes-=i}return s.create(a,i)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});r.Hasher=l.extend({init:function(){this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize(),this._hash},clone:function(){var e=l.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:16,_createHelper:function(e){return function(t,n){return e.create(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return c.HMAC.create(e,n).finalize(t)}}});var c=n.algo={};return n}(Math);(function(e){function n(e,t,n,r,i,s,o){return e=e+(t&n|~t&r)+i+o,(e<<s|e>>>32-s)+t}function r(e,t,n,r,i,s,o){return e=e+(t&r|n&~r)+i+o,(e<<s|e>>>32-s)+t}function i(e,t,n,r,i,s,o){return e=e+(t^n^r)+i+o,(e<<s|e>>>32-s)+t}function s(e,t,n,r,i,s,o){return e=e+(n^(t|~r))+i+o,(e<<s|e>>>32-s)+t}var o=t,u=o.lib,a=u.WordArray,u=u.Hasher,f=o.algo,l=[];(function(){for(var t=0;64>t;t++)l[t]=4294967296*e.abs(e.sin(t+1))|0})(),f=f.MD5=u.extend({_doReset:function(){this._hash=a.create([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var o=0;16>o;o++){var u=t+o,a=e[u];e[u]=(a<<8|a>>>24)&16711935|(a<<24|a>>>8)&4278255360}for(var u=this._hash.words,a=u[0],f=u[1],c=u[2],p=u[3],o=0;64>o;o+=4)16>o?(a=n(a,f,c,p,e[t+o],7,l[o]),p=n(p,a,f,c,e[t+o+1],12,l[o+1]),c=n(c,p,a,f,e[t+o+2],17,l[o+2]),f=n(f,c,p,a,e[t+o+3],22,l[o+3])):32>o?(a=r(a,f,c,p,e[t+(o+1)%16],5,l[o]),p=r(p,a,f,c,e[t+(o+6)%16],9,l[o+1]),c=r(c,p,a,f,e[t+(o+11)%16],14,l[o+2]),f=r(f,c,p,a,e[t+o%16],20,l[o+3])):48>o?(a=i(a,f,c,p,e[t+(3*o+5)%16],4,l[o]),p=i(p,a,f,c,e[t+(3*o+8)%16],11,l[o+1]),c=i(c,p,a,f,e[t+(3*o+11)%16],16,l[o+2]),f=i(f,c,p,a,e[t+(3*o+14)%16],23,l[o+3])):(a=s(a,f,c,p,e[t+3*o%16],6,l[o]),p=s(p,a,f,c,e[t+(3*o+7)%16],10,l[o+1]),c=s(c,p,a,f,e[t+(3*o+14)%16],15,l[o+2]),f=s(f,c,p,a,e[t+(3*o+5)%16],21,l[o+3]));u[0]=u[0]+a|0,u[1]=u[1]+f|0,u[2]=u[2]+c|0,u[3]=u[3]+p|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;t[r>>>5]|=128<<24-r%32,t[(r+64>>>9<<4)+14]=(n<<8|n>>>24)&16711935|(n<<24|n>>>8)&4278255360,e.sigBytes=4*(t.length+1),this._process(),e=this._hash.words;for(t=0;4>t;t++)n=e[t],e[t]=(n<<8|n>>>24)&16711935|(n<<24|n>>>8)&4278255360}}),o.MD5=u._createHelper(f),o.HmacMD5=u._createHmacHelper(f)})(Math);var r,i;i={SUCCESS:1,NOT_AUTHORISED:2,NO_SUCH_METHOD:4,NO_SUCH_FORMAT:8,ACCOUNT_SUSPENDED:16,INVALID_REQUEST:32,UNKNOWN_SERVER_ERROR:64,DATABASE_ERROR:128},r=function(){function r(e,r){this.apiKey=e,this._useSSL=!1,this._scheme="http",this._salt=n(),this._hashedKey=t.MD5(r+this._salt).toString(),this._sessionToken=null}return r.prototype._log=function(e){return typeof console!="undefined"&&console!==null?console.log("KUMULOS: "+e):void 0},r.prototype._urlForMethod=function(e){return""+this._scheme+"://api.kumulos.com/"+this.apiKey+"/"+e+".json"},r.prototype._handleResponse=function(e,t,n){e=JSON.parse(e);if(e.responseCode!==i.SUCCESS)return n(e.responseMessage);t(e.payload);if(this._sessionToken===null)return this._sessionToken=e.sessionToken},r.prototype._buildRequestParams=function(t){return e({hashedKey:this._hashedKey,salt:this._salt,params:t,sessionToken:this._sessionToken})},r.prototype._defaultErrorFn=function(e){return this._log("Request failed with error: "+e)},r.prototype.setUseSSL=function(e){return this._useSSL=e,e===!0?this._scheme="https":this._scheme="http"},r.prototype.useSSL=function(){return this.setUseSSL(!0)},r.prototype.call=function(e,t,n,r){var i,s=this;return r==null&&(r=this._defaultErrorFn),n||(n=t,t={}),i=new XMLHttpRequest,i.open("POST",this._urlForMethod(e)),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.send(this._buildRequestParams(t)),i.onreadystatechange=function(){if(i.readyState===4)return s._handleResponse(i.responseText,n,r)}},r}(),window&&!window.Kumulos&&(window.Kumulos={VERSION:"0.0.1",initWithAPIKeyAndSecretKey:function(e,t){return new r(e,t)}})}).call(this)